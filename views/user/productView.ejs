<%- include('../auth/partials/header.ejs') %>
<style>
    .carousel-item img {
        height: 650px;
        object-fit: contain;
    }

    .zoomable {
        transition: transform 0.3s ease-in-out;
    }

    .zoomable:hover {
        transform: scale(1.3);
    }

    .sizes {
        margin-top: 20px;
    }

    .sizes .size-option {
        border: 1px solid #ddd;
        padding: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .sizes .size-option:hover,
    .sizes .size-option.selected {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }

    .product-info {
        padding: 20px;
    }

    .btn-lg {
        font-size: 18px;
    }
</style>
</head>
<body>

<div class="container mt-5">
    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item"><a href="/category/<%= product.category._id %>"><%= product.category.name %></a></li>
            <li class="breadcrumb-item active" aria-current="page"><%= product.productName %></li>
        </ol>
    </nav>

    <div class="row">
        <!-- Image Carousel -->
        <div class="col-md-6">
            <div id="productCarousel" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <% for(let i = 0; i < product.images.length; i++) { %>
                        <li data-target="#productCarousel" data-slide-to="<%= i %>" class="<%= i === 0 ? 'active' : '' %>"></li>
                    <% } %>
                </ol>
                <div class="carousel-inner">
                    <% product.images.forEach((image, index) => { %>
                        <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                            <img src="/uploads/product-images/<%= image %>" alt="Product Image" class="d-block w-100 zoomable">
                        </div>
                    <% }) %>
                </div>
                <a class="carousel-control-prev" href="#productCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#productCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>

        <!-- Product Information -->
        <div class="col-md-6 product-info">
            <h3><%= product.productName %></h3>
            <p class="text-muted">Category: <%= product.category.name %></p>
            <p><strong>Price: </strong>$<%= product.salesPrice %> <del>$<%= product.regularPrice %></del></p>
            <p><strong>Description:</strong> <%= product.description %></p>

            <!-- Sizes Selection with Stock -->
            <div class="sizes">
                <h5>Select Size (Stock Availability):</h5>
                <div class="d-flex">
                    <% product.sizes.forEach(sizeVariant => { %>
                        <div class="size-option mx-2" onclick="selectSize('<%= sizeVariant.size %>')">
                            <%= sizeVariant.size %> (Stock: <%= sizeVariant.stock %>)
                        </div>
                    <% }) %>
                </div>
            </div>

            <!-- Add to Cart Button -->
            <div class="mt-4">
                <button class="btn btn-primary btn-lg" id="addToCartBtn" disabled>Add to Cart</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    let selectedSize = null;

    // Function to handle size selection
    function selectSize(size) {
        selectedSize = size;

        // Remove 'selected' class from all size options
        document.querySelectorAll('.size-option').forEach(option => {
            option.classList.remove('selected');
        });

        // Add 'selected' class to the clicked size option
        event.target.classList.add('selected');

        // Enable the 'Add to Cart' button
        document.getElementById('addToCartBtn').disabled = false;
    }
</script>

<%- include('../auth/partials/footer.ejs') %>
